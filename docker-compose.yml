services:
  proxy:
    image: ghcr.io/berriai/litellm:main-latest
    # Explicitly hand the secrets ONLY to the proxy
    env_file:
      - .secrets.env
    volumes:
      - ./proxy_config.yaml:/app/config.yaml:ro
    command: ["--config", "/app/config.yaml"]
    networks:
      - agent_net

  agent:
    image: paulgauthier/aider-full
    depends_on:
      - proxy
    # Notice: No environment or env_file section here at all. 
    # It is physically impossible for the agent to see the keys.
    volumes:
      - ./src:/app/src:rw
      - ./agent_settings.yml:/app/.aider.conf.yml:ro
      - ./prompts.md:/app/prompts.md:ro
    working_dir: /app/src
    networks:
      - agent_net
    stdin_open: true 
    tty: true